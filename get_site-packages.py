import subprocess
import sys
import re
import os

def get_site_packages():
    result = subprocess.run([sys.executable, '-m', 'site'], 
                          capture_output=True, 
                          text=True)
    
    paths = result.stdout.split('\n')
    for line in paths:
        if 'site-packages' in line:
            match = re.search(r"'([^']*site-packages)'", line)
            if match:
                return match.group(1)
    
    raise RuntimeError("Could not find site-packages directory")

if __name__ == "__main__":
    site_packages = get_site_packages()
    
    # Check if running in GitHub Actions
    github_env = os.getenv('GITHUB_ENV')
    if github_env:
        with open(github_env, "a") as env_file:
            env_file.write(f"SITE_PACKAGES={site_packages}\n")
    else:
        print(f"SITE_PACKAGES={site_packages}")
